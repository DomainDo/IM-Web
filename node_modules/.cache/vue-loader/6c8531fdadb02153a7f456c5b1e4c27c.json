{"remainingRequest":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\project\\softwareDevelopment\\IM-Web\\src\\components\\message\\message-bubble.vue?vue&type=style&index=0&id=12adadac&lang=stylus&scoped=true&","dependencies":[{"path":"D:\\project\\softwareDevelopment\\IM-Web\\src\\components\\message\\message-bubble.vue","mtime":1649851412191},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\css-loader\\index.js","mtime":1649851454163},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1649851455885},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\postcss-loader\\src\\index.js","mtime":1649851455029},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\stylus-loader\\index.js","mtime":1649851453855},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1649851454799},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\vue-loader\\lib\\index.js","mtime":1649851455309}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  .conversation-container {\n    position absolute\n    top 0\n    left 0px\n    width 100%\n    background-color #fff\n    z-index 999\n  }\n  .conversation-list-btn {\n    width 140px\n    display flex\n    float right\n    margin 10px 0\n    .conversation-btn {\n      cursor pointer\n      padding 6px 12px\n      background #00A4FF\n      color #ffffff\n      font-size 14px\n      border-radius 20px\n      margin-left 13px\n    }\n  }\n.chat-bubble\n  /*position relative*/\n  .message-status\n    display: flex;\n    min-width: 25px;\n    margin-right: 10px;\n    justify-content: center;\n    align-items: center;\n    font-size: 12px;\n    color: #6e7981;\n  .message-content\n    outline: none\n    font-size 14px\n    position relative\n    max-width 350px\n    word-wrap break-word\n    word-break break-all\n    padding 10px\n    box-shadow: 0 5px 10px 0 rgba(0,0,0,.1);\n    /*overflow hidden*/\n    span\n      white-space pre-wrap\n      margin 0\n      text-shadow $regular 0 0 0.05em\n    img\n      vertical-align bottom\n    &::before\n      position: absolute\n      top: 0\n      width: 12px\n      height: 40px\n      content \"\\e900\"\n      // content \"\\e906\"\n      font-family 'tim' !important\n      font-size 24px // 32px 在mac上会模糊 24px正常 , window 24px模糊 28px 32px正常  36px windows mac 基本一致，但是太大\n  .message-received\n    background-color $white\n    margin-left 15px\n    border-radius 0 4px 4px 4px\n    &::before\n      left -10px\n      transform scaleX(-1)\n      color $white\n    &.new\n      transform: scale(0);\n      transform-origin: top left;\n      animation: bounce 500ms linear both;\n  .message-send\n    background-color $light-primary\n    margin-right 15px\n    border-radius 4px 0 4px 4px\n    color $white\n    &::before\n      right: -10px\n      color $light-primary\n    &.new\n      transform: scale(0);\n      transform-origin: top right;\n      animation: bounce 500ms linear both;\n  .el-dropdown {\n    vertical-align: top;\n    display flex\n    outline none\n    border none\n    /deep/ .focusing {\n      outline none\n      border none\n    }\n  }\n  .el-dropdown + .el-dropdown {\n    margin-left: 15px;\n  }\n  .el-icon-arrow-down {\n    font-size: 12px;\n  }\n\n  /deep/ .el-dropdown .el-dropdown-selfdefine:focus:active, .el-dropdown .el-dropdown-selfdefine:focus:not(.focusing) {\n    outline-width: 0;\n  }\n.group-tip-element-wrapper\n  background $white\n  padding 4px 15px\n  border-radius 3px\n  color $secondary\n  font-size 12px\n  // text-shadow $secondary 0 0 0.05em\n.edit-button\n  padding-top 4px\n  height 20px\n  font-size 10px\n@keyframes bounce {\n  0% { transform: matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  4.7% { transform: matrix3d(0.45, 0, 0, 0, 0, 0.45, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  9.41% { transform: matrix3d(0.883, 0, 0, 0, 0, 0.883, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  14.11% { transform: matrix3d(1.141, 0, 0, 0, 0, 1.141, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  18.72% { transform: matrix3d(1.212, 0, 0, 0, 0, 1.212, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  24.32% { transform: matrix3d(1.151, 0, 0, 0, 0, 1.151, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  29.93% { transform: matrix3d(1.048, 0, 0, 0, 0, 1.048, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  35.54% { transform: matrix3d(0.979, 0, 0, 0, 0, 0.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  41.04% { transform: matrix3d(0.961, 0, 0, 0, 0, 0.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  52.15% { transform: matrix3d(0.991, 0, 0, 0, 0, 0.991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  63.26% { transform: matrix3d(1.007, 0, 0, 0, 0, 1.007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  85.49% { transform: matrix3d(0.999, 0, 0, 0, 0, 0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n  100% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\n}\n",{"version":3,"sources":["message-bubble.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"message-bubble.vue","sourceRoot":"src/components/message","sourcesContent":["<template>\r\n  <div class=\"chat-bubble\" @mousedown.stop @contextmenu.prevent>\r\n    <el-dropdown trigger=\"\" ref=\"dropdown\" placement=\"bottom-start\" v-if=\"!message.isRevoked\" @command=\"handleCommand\">\r\n      <div style=\"display: flex\">\r\n        <div v-if=\"isMine && messageReadByPeer\" class=\"message-status\">\r\n          <span>{{messageReadByPeer}}</span>\r\n        </div>\r\n        <div class=\"message-content\" :class=\"bubbleStyle\">\r\n          <slot></slot>\r\n        </div>\r\n      </div>\r\n      <el-dropdown-menu slot=\"dropdown\">\r\n        <el-dropdown-item command=\"revoke\" v-if=\"isMine&&!isTimeout\">撤回</el-dropdown-item>\r\n        <el-dropdown-item command=\"relay\" v-show=\"message.status !=='fail'\">转发</el-dropdown-item>\r\n        <el-dropdown-item command=\"merger\" v-show=\"message.status !=='fail'\">多选</el-dropdown-item>\r\n      </el-dropdown-menu>\r\n    </el-dropdown>\r\n    <div class=\"group-tip-element-wrapper\" v-if=\"message.isRevoked\">\r\n      {{text}}\r\n      <el-button type=\"text\" size=\"mini\" class=\"edit-button\" v-show=\"isEdit\" @click=\"reEdit\">&nbsp;重新编辑</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n  export default {\r\n  name: 'MessageBubble',\r\n  components: {\r\n  },\r\n  data() {\r\n    return {\r\n      isTimeout: false,\r\n      showConversationList: false,\r\n      relayMessage: {},\r\n      selectedConversation: [],\r\n      testMergerMessage: {}\r\n    }\r\n  },\r\n  props: {\r\n    isMine: {\r\n      type: Boolean\r\n    },\r\n    isNew: {\r\n      type: Boolean\r\n    },\r\n    message: {\r\n      type: Object,\r\n      required: true\r\n    }\r\n  },\r\n  created() {\r\n    this.isTimeoutHandler()\r\n  },\r\n  mounted() {\r\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\r\n      this.$refs.dropdown.$el.addEventListener('mousedown', this.handleDropDownMousedown)\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    if (this.$refs.dropdown && this.$refs.dropdown.$el) {\r\n      this.$refs.dropdown.$el.removeEventListener('mousedown', this.handleDropDownMousedown)\r\n    }\r\n  },\r\n  updated() {\r\n  },\r\n  computed: {\r\n    bubbleStyle() {\r\n      let classString = ''\r\n      if (this.isMine) {\r\n        classString += 'message-send'\r\n      } else {\r\n        classString += 'message-received'\r\n      }\r\n      if (this.isNew) {\r\n        classString += 'new'\r\n      }\r\n      return classString\r\n    },\r\n    text() {\r\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.isMine) {\r\n        return '对方撤回了一条消息'\r\n      }\r\n      if (this.message.conversationType === this.TIM.TYPES.CONV_GROUP && !this.isMine) {\r\n        return `${this.message.from}撤回了一条消息`\r\n      }\r\n      return '你撤回了一条消息'\r\n    },\r\n    messageReadByPeer() {\r\n      if (this.message.status !== 'success') {\r\n        return false\r\n      }\r\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && this.message.isPeerRead) {\r\n        return '已读'\r\n      }\r\n      if (this.message.conversationType === this.TIM.TYPES.CONV_C2C && !this.message.isPeerRead) {\r\n        return '未读'\r\n      }\r\n      return ''\r\n    },\r\n    isEdit() {\r\n      if (!this.isMine) {\r\n        return false\r\n      }\r\n      if (this.message.type !== this.TIM.TYPES.MSG_TEXT) {\r\n        return false\r\n      }\r\n      if (this.isTimeout) {\r\n        return false\r\n      }\r\n      return true\r\n    },\r\n  },\r\n  methods: {\r\n    handleDropDownMousedown(e) {\r\n      if (e.buttons === 2) {\r\n        if (this.$refs.dropdown.visible) {\r\n          this.$refs.dropdown.hide()\r\n        } else {\r\n          this.$refs.dropdown.show()\r\n        }\r\n      }\r\n    },\r\n    handleCommand(command) {\r\n      switch (command) {\r\n        case 'revoke':\r\n          this.tim.revokeMessage(this.message).then(() => {\r\n            this.isTimeoutHandler()\r\n          }).catch((err) => {\r\n            this.$store.commit('showMessage', {\r\n              message: err,\r\n              type: 'warning'\r\n            })\r\n          })\r\n          break\r\n        case 'relay':\r\n          this.showConversationList = true\r\n          this.$store.commit('setRelayType', 1)\r\n          this.$store.commit('showConversationList', true)\r\n          this.$store.commit('setRelayMessage', this.message)\r\n          break\r\n        case 'merger':\r\n          this.$bus.$emit('mergerSelected',true)\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    },\r\n    isTimeoutHandler() { // 从发送消息时间开始算起，两分钟内可以编辑\r\n      let now = new Date()\r\n      if (parseInt(now.getTime() / 1000) - this.message.time > 2 * 60) {\r\n        this.isTimeout = true\r\n        return\r\n      }\r\n      setTimeout(this.isTimeoutHandler, 1000)\r\n    },\r\n    reEdit() {\r\n      this.$bus.$emit('reEditMessage', this.message.payload.text)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n  .conversation-container {\r\n    position absolute\r\n    top 0\r\n    left 0px\r\n    width 100%\r\n    background-color #fff\r\n    z-index 999\r\n  }\r\n  .conversation-list-btn {\r\n    width 140px\r\n    display flex\r\n    float right\r\n    margin 10px 0\r\n    .conversation-btn {\r\n      cursor pointer\r\n      padding 6px 12px\r\n      background #00A4FF\r\n      color #ffffff\r\n      font-size 14px\r\n      border-radius 20px\r\n      margin-left 13px\r\n    }\r\n  }\r\n.chat-bubble\r\n  /*position relative*/\r\n  .message-status\r\n    display: flex;\r\n    min-width: 25px;\r\n    margin-right: 10px;\r\n    justify-content: center;\r\n    align-items: center;\r\n    font-size: 12px;\r\n    color: #6e7981;\r\n  .message-content\r\n    outline: none\r\n    font-size 14px\r\n    position relative\r\n    max-width 350px\r\n    word-wrap break-word\r\n    word-break break-all\r\n    padding 10px\r\n    box-shadow: 0 5px 10px 0 rgba(0,0,0,.1);\r\n    /*overflow hidden*/\r\n    span\r\n      white-space pre-wrap\r\n      margin 0\r\n      text-shadow $regular 0 0 0.05em\r\n    img\r\n      vertical-align bottom\r\n    &::before\r\n      position: absolute\r\n      top: 0\r\n      width: 12px\r\n      height: 40px\r\n      content \"\\e900\"\r\n      // content \"\\e906\"\r\n      font-family 'tim' !important\r\n      font-size 24px // 32px 在mac上会模糊 24px正常 , window 24px模糊 28px 32px正常  36px windows mac 基本一致，但是太大\r\n  .message-received\r\n    background-color $white\r\n    margin-left 15px\r\n    border-radius 0 4px 4px 4px\r\n    &::before\r\n      left -10px\r\n      transform scaleX(-1)\r\n      color $white\r\n    &.new\r\n      transform: scale(0);\r\n      transform-origin: top left;\r\n      animation: bounce 500ms linear both;\r\n  .message-send\r\n    background-color $light-primary\r\n    margin-right 15px\r\n    border-radius 4px 0 4px 4px\r\n    color $white\r\n    &::before\r\n      right: -10px\r\n      color $light-primary\r\n    &.new\r\n      transform: scale(0);\r\n      transform-origin: top right;\r\n      animation: bounce 500ms linear both;\r\n  .el-dropdown {\r\n    vertical-align: top;\r\n    display flex\r\n    outline none\r\n    border none\r\n    /deep/ .focusing {\r\n      outline none\r\n      border none\r\n    }\r\n  }\r\n  .el-dropdown + .el-dropdown {\r\n    margin-left: 15px;\r\n  }\r\n  .el-icon-arrow-down {\r\n    font-size: 12px;\r\n  }\r\n\r\n  /deep/ .el-dropdown .el-dropdown-selfdefine:focus:active, .el-dropdown .el-dropdown-selfdefine:focus:not(.focusing) {\r\n    outline-width: 0;\r\n  }\r\n.group-tip-element-wrapper\r\n  background $white\r\n  padding 4px 15px\r\n  border-radius 3px\r\n  color $secondary\r\n  font-size 12px\r\n  // text-shadow $secondary 0 0 0.05em\r\n.edit-button\r\n  padding-top 4px\r\n  height 20px\r\n  font-size 10px\r\n@keyframes bounce {\r\n  0% { transform: matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  4.7% { transform: matrix3d(0.45, 0, 0, 0, 0, 0.45, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  9.41% { transform: matrix3d(0.883, 0, 0, 0, 0, 0.883, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  14.11% { transform: matrix3d(1.141, 0, 0, 0, 0, 1.141, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  18.72% { transform: matrix3d(1.212, 0, 0, 0, 0, 1.212, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  24.32% { transform: matrix3d(1.151, 0, 0, 0, 0, 1.151, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  29.93% { transform: matrix3d(1.048, 0, 0, 0, 0, 1.048, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  35.54% { transform: matrix3d(0.979, 0, 0, 0, 0, 0.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  41.04% { transform: matrix3d(0.961, 0, 0, 0, 0, 0.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  52.15% { transform: matrix3d(0.991, 0, 0, 0, 0, 0.991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  63.26% { transform: matrix3d(1.007, 0, 0, 0, 0, 1.007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  85.49% { transform: matrix3d(0.999, 0, 0, 0, 0, 0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n  100% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); }\r\n}\r\n</style>\r\n"]}]}