{"remainingRequest":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\babel-loader\\lib\\index.js!D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\project\\softwareDevelopment\\IM-Web\\src\\components\\friend\\friend-container.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\project\\softwareDevelopment\\IM-Web\\src\\components\\friend\\friend-container.vue","mtime":1649851412187},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1649851454799},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\babel-loader\\lib\\index.js","mtime":1649851455045},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1649851454799},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\vue-loader\\lib\\index.js","mtime":1649851455309},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\babel.config.js","mtime":1649851550121},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1649851454799},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\babel-loader\\lib\\index.js","mtime":1649851455045},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1649851454799},{"path":"D:\\project\\softwareDevelopment\\IM-Web\\node_modules\\vue-loader\\lib\\index.js","mtime":1649851455309}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"D:/project/softwareDevelopment/IM-Web/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState } from 'vuex';\nexport default {\n  name: 'index',\n  data: function data() {\n    return {\n      showEdit: false,\n      showEditRemark: false,\n      showRemark: false,\n      addGroupName: '',\n      profileRemark: '',\n      editGroupList: [],\n      isUpdate: false,\n      acceptApplication: {\n        remark: '',\n        type: 'Response_Action_AgreeAndAdd'\n      }\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapState({\n    friendContent: function friendContent(state) {\n      return state.friend.friendContent;\n    },\n    applicationContent: function applicationContent(state) {\n      return state.friend.applicationContent;\n    },\n    friendGroupList: function friendGroupList(state) {\n      return state.friend.friendGroupList;\n    }\n  })), {}, {\n    showFriendContent: function showFriendContent() {\n      if (JSON.stringify(this.friendContent) === '{}') {\n        return false;\n      }\n\n      return true;\n    },\n    showApplicationContent: function showApplicationContent() {\n      if (JSON.stringify(this.applicationContent) === '{}') {\n        return false;\n      }\n\n      return true;\n    },\n    friendProfile: function friendProfile() {\n      return this.friendContent.friend;\n    },\n    groupName: function groupName() {\n      if (this.friendProfile.groupList.length > 0) {\n        return this.friendProfile.groupList.join(',');\n      } else {\n        return '暂无分组';\n      }\n    },\n    groupList: {\n      get: function get() {\n        return this.friendProfile.groupList;\n      },\n      set: function set(value) {\n        this.editGroupList = value;\n      }\n    },\n    friendType: function friendType() {\n      return this.friendContent.type;\n    },\n    getSource: function getSource() {\n      return function (source) {\n        return source.substring(15);\n      };\n    }\n  }),\n  methods: {\n    showEditHandler: function showEditHandler() {\n      this.showEdit = true;\n      this.addGroupName = '';\n    },\n    inputFocus: function inputFocus(ref) {\n      var _this = this;\n\n      this.profileRemark = this.friendProfile.remark;\n      this.$nextTick(function () {\n        _this.$refs[ref].focus();\n      });\n    },\n    blurHandler: function blurHandler() {\n      this.showEditRemark = false;\n      this.isUpdate = true;\n    },\n    remarkBlurHandler: function remarkBlurHandler() {// this.showEditRemark = false\n    },\n    acceptHandler: function acceptHandler() {\n      var _this2 = this;\n\n      this.showRemark = true;\n      this.acceptApplication.remark = '';\n      this.$nextTick(function () {\n        _this2.$refs.showRemark.focus();\n      });\n    },\n    cancelHandler: function cancelHandler() {\n      this.showRemark = false;\n    },\n    closeHandler: function closeHandler() {\n      this.showEdit = false;\n\n      if (this.isUpdate) {\n        this.editRemarkHandler();\n      }\n    },\n    editRemarkHandler: function editRemarkHandler() {\n      this.showEditRemark = false; // 更新好友备注\n\n      this.tim.updateFriend({\n        userID: this.friendProfile.userID,\n        remark: this.profileRemark\n      }).then(function () {}).catch(function (imError) {\n        console.warn('getFriendProfile error:', imError); // 更新失败\n      });\n      this.isUpdate = false;\n    },\n    updateFriendGroup: function updateFriendGroup() {\n      this.profileRemark = this.friendProfile.remark; // 更新好友分组\n\n      this.tim.updateFriend({\n        userID: this.friendProfile.userID,\n        groupList: this.editGroupList\n      }).then(function () {}).catch(function (imError) {\n        console.warn('getFriendProfile error:', imError); // 更新失败\n      });\n    },\n    checkoutConversation: function checkoutConversation(userID) {\n      var _this3 = this;\n\n      this.$store.dispatch('checkoutConversation', \"C2C\".concat(userID)).then(function () {\n        _this3.showDialog = false;\n\n        _this3.$bus.$emit('checkoutConversation');\n      }).catch(function () {\n        _this3.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        });\n      });\n    },\n    addToFriendGroup: function addToFriendGroup() {\n      var _this4 = this;\n\n      this.tim.addToFriendGroup({\n        name: this.addGroupName,\n        userIDList: [this.friendProfile.userID]\n      }).then(function () {\n        _this4.$store.commit('showMessage', {\n          message: '添加成功',\n          type: 'success'\n        });\n      }).catch(function (error) {\n        _this4.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n      this.showEdit = false;\n    },\n    removeFromFriendGroup: function removeFromFriendGroup(userID) {\n      var _this5 = this;\n\n      this.tim.removeFromFriendGroup({\n        name: this.friendContent.groupName,\n        userIDList: [userID]\n      }).then(function () {\n        _this5.resetContent(); // 清空页面\n\n      }).catch(function () {});\n    },\n    removeFromFriendList: function removeFromFriendList(userID) {\n      var _this6 = this;\n\n      this.tim.deleteFriend({\n        userIDList: [userID],\n        type: 'Delete_Type_Both'\n      }).then(function () {\n        _this6.resetContent(); // 清空页面\n\n      }).catch(function (error) {\n        _this6.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n    },\n    // 同意\n    acceptFriendApplication: function acceptFriendApplication(userID) {\n      var _this7 = this;\n\n      this.tim.acceptFriendApplication({\n        userID: userID,\n        remark: this.acceptApplication.remark,\n        tag: this.acceptApplication.tag,\n        type: this.acceptApplication.type\n      }).then(function () {\n        _this7.resetContent();\n\n        _this7.$store.commit('showMessage', {\n          message: '已同意加好友',\n          type: 'success'\n        });\n      }).catch(function (error) {\n        _this7.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n      this.acceptApplication.remark = '';\n      this.showRemark = false;\n    },\n    // application\n    deleteFriendApplication: function deleteFriendApplication(application) {\n      var _this8 = this;\n\n      this.$store.commit('updateUnreadCount', 0);\n      this.tim.deleteFriendApplication({\n        userID: application.userID,\n        type: application.type\n      }).then(function () {\n        _this8.resetContent(); // 清空页面\n\n\n        _this8.$store.commit('showMessage', {\n          message: '已删除',\n          type: 'success'\n        });\n      }).catch(function (error) {\n        _this8.$store.commit('showMessage', {\n          type: 'error',\n          message: error.message\n        });\n      });\n    },\n    // 拒绝\n    refuseFriendApplication: function refuseFriendApplication(userID) {\n      var _this9 = this;\n\n      this.$store.commit('updateUnreadCount', 0);\n      this.tim.refuseFriendApplication({\n        userID: userID\n      }).then(function () {\n        _this9.resetContent(); // 清空页面\n\n\n        _this9.$store.commit('showMessage', {\n          message: '已拒绝',\n          type: 'success'\n        }).catch(function (error) {\n          _this9.$store.commit('showMessage', {\n            type: 'error',\n            message: error.message\n          });\n        });\n      });\n    },\n    resetContent: function resetContent() {\n      this.$store.commit('resetCurrentConversation');\n      this.$store.commit('resetFriendContent');\n      this.$store.commit('resetApplicationContent');\n    }\n  }\n};",{"version":3,"mappings":"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","names":["name","data","showEdit","showEditRemark","showRemark","addGroupName","profileRemark","editGroupList","isUpdate","acceptApplication","remark","type","computed","mapState","friendContent","applicationContent","friendGroupList","showFriendContent","showApplicationContent","friendProfile","groupName","groupList","get","set","value","friendType","getSource","methods","showEditHandler","inputFocus","ref","blurHandler","remarkBlurHandler","acceptHandler","cancelHandler","closeHandler","editRemarkHandler","userID","then","catch","console","updateFriendGroup","checkoutConversation","dispatch","message","addToFriendGroup","userIDList","removeFromFriendGroup","removeFromFriendList","acceptFriendApplication","tag","deleteFriendApplication","application","refuseFriendApplication","resetContent"],"sourceRoot":"src/components/friend","sources":["friend-container.vue"],"sourcesContent":["<template>\r\n    <div class=\"friend-content\" v-if=\"showFriendContent || showApplicationContent\" @click=\"closeHandler\">\r\n        <div class=\"friend-box\" v-if=\"showFriendContent\">\r\n            <div class=\"profile-container\" >\r\n                <div class=\"item-nick text-ellipsis\">{{friendProfile.profile.nick||friendProfile.profile.userID}}</div>\r\n                <img\r\n                        class=\"avatar\"\r\n                        :src=\"friendProfile.profile.avatar ? friendProfile.profile.avatar : 'https://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png'\"\r\n                />\r\n            </div>\r\n            <el-divider></el-divider>\r\n            <p class=\"content-box\"><span class=\"content-title\">userID</span><span class=\"content-text\">{{friendProfile.userID}}</span></p>\r\n            <div class=\"content-box\"><span class=\"content-title\">备注名</span>\r\n                <div class=\"text-box\"   v-if=\"!showEditRemark\">\r\n                    <span class=\"content-text  content-width text-ellipsis\">{{friendProfile.remark || '暂无'}}</span>\r\n                    <i\r\n                            class=\"el-icon-edit\"\r\n                            @click.stop=\"\r\n                        showEditRemark = true\r\n                        inputFocus('showEditRemark')\r\n\r\n            \"\r\n                            style=\"cursor:pointer; font-size:16px; margin-left: 6px\"\r\n                    />\r\n                </div>\r\n                <el-input\r\n                        style=\"display: inline-block\"\r\n                        ref=\"showEditRemark\"\r\n                        v-else\r\n                        autofocus\r\n                        v-model=\"profileRemark\"\r\n                        size=\"mini\"\r\n                        @blur=\"blurHandler\"\r\n                        @keydown.enter.native=\"editRemarkHandler\"\r\n                />\r\n            </div>\r\n\r\n            <p class=\"content-box\"><span class=\"content-title\">来源</span><span class=\"content-text\">{{getSource(friendProfile.source)}}</span></p>\r\n            <el-divider></el-divider>\r\n            <div class=\"content-box\" v-show=\"friendType==='friendList'\">\r\n                <span class=\"content-title\" v-show=\"!showEdit\" style=\"line-height: 35px\">所在分组</span>\r\n                <span class=\"content-title\" v-show=\"showEdit\"  style=\"line-height: 35px\">添加到分组</span>\r\n                <div class=\"text-content\">\r\n                    <span class=\"content-text\" v-show=\"!showEdit\">{{groupName}}</span>\r\n                    <i class=\"el-icon-edit edit-icon\" v-show=\"!showEdit\"   @click.stop=\"showEditHandler\"></i>\r\n                </div>\r\n                <el-select v-if=\"showEdit\" v-model=\"addGroupName\"  placeholder=\"选择分组\" @change=\"addToFriendGroup\">\r\n                    <el-option\r\n                            v-for=\"item in friendGroupList\"\r\n                            @blur=\"showEdit = false\"\r\n                            :key=\"item.name\"\r\n                            :label=\"item.name\"\r\n                            :value=\"item.name\">\r\n                    </el-option>\r\n                </el-select>\r\n            </div>\r\n            <p class=\"content-box\" v-show=\"friendType==='groupFriend'\" style=\"height: 40px\">\r\n                <span class=\"content-title\" style=\"line-height: 35px\">所在分组</span>\r\n                <span class=\"content-text\" v-show=\"!showEdit\" style=\"line-height: 35px\">{{groupName}}</span>\r\n            </p>\r\n            <div class=\"sendBtn\" @click.stop=\"checkoutConversation(friendProfile.userID)\">发送消息</div>\r\n            <div class=\"delete-text\" v-show=\"friendType==='groupFriend'\" @click.stop=\"removeFromFriendGroup(friendProfile.userID)\">从该群组中移除</div>\r\n            <div class=\"delete-text\" v-show=\"friendType==='friendList'\" @click.stop=\"removeFromFriendList(friendProfile.userID)\">删除该好友</div>\r\n        </div>\r\n        <div class=\"friend-box\" v-if=\"showApplicationContent\">\r\n            <div class=\"profile-container\" >\r\n                <div class=\"item-nick text-ellipsis\">{{applicationContent.nick||applicationContent.userID}}</div>\r\n                <img\r\n                        class=\"avatar\"\r\n                        :src=\"applicationContent.avatar ? applicationContent.avatar : 'http://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png'\"\r\n                />\r\n            </div>\r\n            <el-divider></el-divider>\r\n            <p class=\"content-box\"><span class=\"content-title\">userID</span><span class=\"content-text\">{{applicationContent.userID}}</span></p>\r\n            <p class=\"content-box\"><span class=\"content-title\">来源</span><span class=\"content-text content-width text-ellipsis\">{{getSource(applicationContent.source)}}</span></p>\r\n            <div class=\"content-box\" v-if=\"showRemark\"><span class=\"content-title\">备注名</span>\r\n                <el-input\r\n                        style=\"display: inline-block\"\r\n                        ref=\"showRemark\"\r\n                        autofocus\r\n                        v-model=\"acceptApplication.remark\"\r\n                        size=\"mini\"\r\n                        @blur=\"remarkBlurHandler\"\r\n                        @keydown.enter.native=\"editRemarkHandler\"\r\n                />\r\n            </div>\r\n            <el-divider></el-divider>\r\n            <p class=\"content-box\">\r\n                <span class=\"content-title\">打招呼</span>\r\n                <el-tooltip class=\"item\" effect=\"dark\" :content=\"applicationContent.wording\" placement=\"bottom-end\">\r\n                    <span class=\"content-text content-width text-ellipsis\">{{applicationContent.wording}}</span>\r\n                </el-tooltip>\r\n            </p>\r\n            <div class=\"application-box\" v-if=\"!showRemark\">\r\n                <p class=\"application-refuse\" @click=\"acceptHandler\">同意</p>\r\n                <p class=\"application-delete\"  @click=\"refuseFriendApplication(applicationContent.userID)\">拒绝</p>\r\n            </div>\r\n            <div class=\"application-box\" v-else>\r\n                <p class=\"application-refuse\" @click=\"acceptFriendApplication(applicationContent.userID)\">确认</p>\r\n                <p class=\"application-delete\"  @click=\"cancelHandler()\">取消</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  import { mapState } from 'vuex'\r\n  export default {\r\n    name: 'index',\r\n    data() {\r\n      return {\r\n        showEdit: false,\r\n        showEditRemark: false,\r\n        showRemark: false,\r\n        addGroupName: '',\r\n        profileRemark: '',\r\n        editGroupList: [],\r\n        isUpdate: false,\r\n        acceptApplication: {\r\n          remark: '',\r\n          type: 'Response_Action_AgreeAndAdd',\r\n        },\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState({\r\n        friendContent: state => state.friend.friendContent,\r\n        applicationContent: state => state.friend.applicationContent,\r\n        friendGroupList: state => state.friend.friendGroupList,\r\n      }),\r\n      showFriendContent() {\r\n        if (JSON.stringify(this.friendContent) === '{}') {\r\n          return false\r\n        }\r\n        return true\r\n      },\r\n      showApplicationContent() {\r\n        if (JSON.stringify(this.applicationContent) === '{}') {\r\n          return false\r\n        }\r\n        return true\r\n      },\r\n      friendProfile() {\r\n        return this.friendContent.friend\r\n      },\r\n      groupName() {\r\n        if(this.friendProfile.groupList.length>0) {\r\n          return this.friendProfile.groupList.join(',')\r\n        }else {\r\n          return '暂无分组'\r\n        }\r\n      },\r\n      groupList:{\r\n        get() {\r\n          return this.friendProfile.groupList\r\n        },\r\n        set(value) {\r\n          this.editGroupList = value\r\n        }\r\n      },\r\n      friendType() {\r\n        return this.friendContent.type\r\n      },\r\n      getSource() {\r\n        return function (source) {\r\n          return source.substring(15)\r\n        }\r\n      },\r\n    },\r\n    methods: {\r\n      showEditHandler() {\r\n        this.showEdit = true\r\n        this.addGroupName = ''\r\n      },\r\n      inputFocus(ref) {\r\n        this.profileRemark = this.friendProfile.remark\r\n        this.$nextTick(() => {\r\n          this.$refs[ref].focus()\r\n        })\r\n      },\r\n      blurHandler() {\r\n        this.showEditRemark = false\r\n        this.isUpdate = true\r\n      },\r\n      remarkBlurHandler() {\r\n        // this.showEditRemark = false\r\n      },\r\n      acceptHandler() {\r\n        this.showRemark = true\r\n        this.acceptApplication.remark = ''\r\n        this.$nextTick(() => {\r\n          this.$refs.showRemark.focus()\r\n        })\r\n      },\r\n      cancelHandler() {\r\n        this.showRemark = false\r\n      },\r\n      closeHandler() {\r\n        this.showEdit = false\r\n        if (this.isUpdate) {\r\n          this.editRemarkHandler()\r\n        }\r\n      },\r\n      editRemarkHandler() {\r\n        this.showEditRemark = false\r\n        // 更新好友备注\r\n        this.tim.updateFriend({\r\n          userID: this.friendProfile.userID,\r\n          remark: this.profileRemark\r\n        }).then(()=> {\r\n        }).catch((imError)=> {\r\n          console.warn('getFriendProfile error:', imError) // 更新失败\r\n        })\r\n        this.isUpdate = false\r\n      },\r\n      updateFriendGroup() {\r\n        this.profileRemark = this.friendProfile.remark\r\n        // 更新好友分组\r\n        this.tim.updateFriend({\r\n          userID: this.friendProfile.userID,\r\n          groupList: this.editGroupList\r\n        }).then(()=>{\r\n        }).catch((imError)=> {\r\n          console.warn('getFriendProfile error:', imError) // 更新失败\r\n        })\r\n      },\r\n      checkoutConversation(userID) {\r\n        this.$store\r\n          .dispatch('checkoutConversation', `C2C${userID}`)\r\n          .then(() => {\r\n            this.showDialog = false\r\n            this.$bus.$emit('checkoutConversation')\r\n          }).catch(() => {\r\n          this.$store.commit('showMessage', {\r\n            message: '没有找到该用户',\r\n            type: 'warning'\r\n          })\r\n        })\r\n      },\r\n      addToFriendGroup() {\r\n        this.tim.addToFriendGroup({name: this.addGroupName, userIDList: [this.friendProfile.userID]}).then(() => {\r\n          this.$store.commit('showMessage', {\r\n            message: '添加成功',\r\n            type: 'success'\r\n          })\r\n        }).catch((error) => {\r\n          this.$store.commit('showMessage', {\r\n            type: 'error',\r\n            message: error.message\r\n          })\r\n        })\r\n        this.showEdit = false\r\n      },\r\n      removeFromFriendGroup(userID) {\r\n        this.tim.removeFromFriendGroup({\r\n          name: this.friendContent.groupName,\r\n          userIDList: [userID],\r\n        }).then(() => {\r\n          this.resetContent() // 清空页面\r\n        }).catch(() => {\r\n        })\r\n      },\r\n      removeFromFriendList(userID) {\r\n        this.tim.deleteFriend({\r\n          userIDList: [userID],\r\n          type: 'Delete_Type_Both'\r\n        }).then(() => {\r\n          this.resetContent() // 清空页面\r\n        }).catch(error => {\r\n          this.$store.commit('showMessage', {\r\n            type: 'error',\r\n            message: error.message\r\n          })\r\n        })\r\n      },\r\n      // 同意\r\n      acceptFriendApplication(userID) {\r\n        this.tim.acceptFriendApplication({\r\n          userID: userID,\r\n          remark: this.acceptApplication.remark,\r\n          tag: this.acceptApplication.tag,\r\n          type: this.acceptApplication.type\r\n        }).then(() => {\r\n          this.resetContent()\r\n          this.$store.commit('showMessage', {\r\n            message: '已同意加好友',\r\n            type: 'success'\r\n          })\r\n\r\n        }).catch((error) => {\r\n          this.$store.commit('showMessage', {\r\n            type: 'error',\r\n            message: error.message\r\n          })\r\n        })\r\n        this.acceptApplication.remark = ''\r\n        this.showRemark = false\r\n      },\r\n      // application\r\n      deleteFriendApplication(application) {\r\n        this.$store.commit('updateUnreadCount', 0)\r\n        this.tim.deleteFriendApplication({userID: application.userID ,type: application.type}).then(() => {\r\n          this.resetContent() // 清空页面\r\n          this.$store.commit('showMessage', {\r\n            message: '已删除',\r\n            type: 'success'\r\n          })\r\n        }).catch((error) => {\r\n          this.$store.commit('showMessage', {\r\n            type: 'error',\r\n            message: error.message\r\n          })\r\n        })\r\n      },\r\n      // 拒绝\r\n      refuseFriendApplication(userID) {\r\n        this.$store.commit('updateUnreadCount', 0)\r\n        this.tim.refuseFriendApplication({\r\n          userID: userID\r\n        }).then(() => {\r\n          this.resetContent() // 清空页面\r\n          this.$store.commit('showMessage', {\r\n            message: '已拒绝',\r\n            type: 'success'\r\n          }).catch((error) => {\r\n            this.$store.commit('showMessage', {\r\n              type: 'error',\r\n              message: error.message\r\n            })\r\n          })\r\n        })\r\n      },\r\n      resetContent() {\r\n        this.$store.commit('resetCurrentConversation')\r\n        this.$store.commit('resetFriendContent')\r\n        this.$store.commit('resetApplicationContent')\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"stylus\" scpoed>\r\n    .friend-content {\r\n        /*width 60%*/\r\n        width 100%\r\n        .friend-box {\r\n            margin 100px auto 0\r\n            width 360px\r\n            .profile-container {\r\n                display flex\r\n                justify-content space-between\r\n                .item-nick {\r\n                    width 200px\r\n                    line-height 48px\r\n                }\r\n                .avatar {\r\n                    display block\r\n                    width 48px\r\n                    height 48px\r\n                    border-radius 50%\r\n                    margin-right 25px\r\n                }\r\n            }\r\n            .el-input {\r\n                width 50%\r\n            }\r\n            .el-select .el-input {\r\n                width 100%\r\n            }\r\n            .content-box {\r\n                display flex\r\n                /*justify-content space-between*/\r\n                margin 18px 0\r\n                .text-content {\r\n                    height 40px\r\n                }\r\n                .text-box {\r\n                    display flex\r\n                    justify-content center\r\n                    align-items center\r\n                }\r\n                .content-title {\r\n                    display inline-block\r\n                    min-width 80px\r\n                    font-size 16px\r\n                    color #717175\r\n                    margin-right 140px\r\n                }\r\n                .content-text {\r\n                    font-size 18px\r\n                    color #000000\r\n                    word-break break-word\r\n                }\r\n                .content-width {\r\n                    display inline-block\r\n                    max-width 115px\r\n                    height 28px\r\n                }\r\n                .edit-icon {\r\n                    cursor: pointer\r\n                    font-size 16px\r\n                    margin-left 6px\r\n                    margin-top 8px\r\n                }\r\n\r\n            }\r\n\r\n            .sendBtn {\r\n                cursor pointer\r\n                width 120px\r\n                height 40px\r\n                border-radius 5px\r\n                background-color #00A4FF\r\n                color #ffffff\r\n                font-size 16px\r\n                margin 80px auto 0\r\n                text-align center\r\n                line-height 40px\r\n            }\r\n\r\n            .delete-text {\r\n                position absolute\r\n                cursor pointer\r\n                left 0\r\n                right 0\r\n                margin auto\r\n                bottom 25px\r\n                width 120px\r\n                height 40px\r\n                font-size 17px\r\n                color #586B95\r\n                text-align center\r\n            }\r\n            .application-box {\r\n                display flex\r\n                justify-content space-between\r\n            }\r\n            .application-delete {\r\n                cursor pointer\r\n                width 120px\r\n                height 40px\r\n                border-radius 5px\r\n                border 1px solid #00A4FF\r\n                color #1c2438\r\n                font-size 16px\r\n                margin-top 80px\r\n                text-align center\r\n                line-height 40px\r\n            }\r\n            .application-refuse {\r\n                cursor pointer\r\n                width 120px\r\n                height 40px\r\n                border-radius 5px\r\n                background-color #00A4FF\r\n                border 1px solid #00A4FF\r\n                color #ffffff\r\n                font-size 16px\r\n                margin-top 80px\r\n                text-align center\r\n                line-height 40px\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n</style>\r\n"]}]}